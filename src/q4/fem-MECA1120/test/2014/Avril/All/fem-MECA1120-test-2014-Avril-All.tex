\documentclass[fr]{../../../../../../epltest}

\usepackage{../../../../../../eplcommon}

\usepackage{physics}
\usepackage{tikz}
\usepackage{xcolor}
\usepackage{relsize}

\newcounter{choice}
\renewcommand\thechoice{\textbf{\arabic{choice}}}
\newcommand\choicelabel{\thechoice\textbf{.}$\quad$}

\newenvironment{choices}%
  {\list{\choicelabel}%
     {\usecounter{choice}\def\makelabel##1{\hss\llap{##1}}%
       \settowidth{\leftmargin}{W.\hskip\labelsep\hskip 2.5em}%
       \def\choice{%
         \item
       } % choice
       \labelwidth\leftmargin\advance\labelwidth-\labelsep
       \topsep=0pt
       \partopsep=0pt
     }%
  }%
  {\endlist}

  \makeatletter
  \DeclareRobustCommand{\genericinterval}[2]{%
    \@ifstar{\genericinterval@star{#1}{#2}}{\genericinterval@nostar{#1}{#2}}}
  \newcommand{\genericinterval@star}[4]{\mathopen{}\mathclose{\left#1#3,#4\right#2}}
  \newcommand{\genericinterval@nostar}[4]{\mathopen{#1}#3,#4\mathclose{#2}}
  \newcommand{\intervalcc}{\genericinterval[]}
  \newcommand{\intervaloo}{\genericinterval][}
  \newcommand{\intervaloc}{\genericinterval]]}
  \newcommand{\intervalco}{\genericinterval[[}
  \makeatother

\DeclareMathOperator{\cartprod}{\times}

\usepackage{../../../../../../eplcode}

\lstset{language={C}}

\hypertitle[']{Introduction aux méthodes d'éléments finis}{4}{MECA}{1120}{2014}{Avril}
{Gilles Peiffer \and Jérôme Rutté}
{Vincent Legat}

\section{Question 1}

L'ensemble des solutions de l'équation aux dérivées partielles

\begin{align*}
     \pdv{u}{t} + c\pdv{u}{x} = 0
\end{align*}

est donné par :

\vspace*{\baselineskip}
\begin{choices}
     \choice \label{right1} $u(x,t) = f(x - ct)$.
     \choice $u(x,t) = g(x + ct)$.
     \choice $u(x,t) = f(x - ct) + g(x + ct)$.
     \choice $u(x,t) = f(x - ct) g(x + ct)$.
\end{choices}
\vspace*{\baselineskip}

où les fonctions $f$ et $g$ sont déterminées par les conditions aux limites.

\begin{solution}
     Il s'agit de l'équation de transport homogène.

     Supposons avoir trouvé une fonction régulière qui résout l'équation
     ci-dessus. On sait également que $(x,t) \in \R \cartprod
     {\intervaloo{0}{+\infty}}$. On définit alors

     \begin{align*}
          z(s) \coloneqq u(x + cs, t + s)
     \end{align*}

     pour $s \in \R$. On a alors

     \begin{align*}
          z'(s) &= \grad u(x + cs, xt + s) \begin{pmatrix} c \\ 1
          \end{pmatrix}\\
          &= \pdv{u}{x}(x + cs, t + s) c + \pdv{u}{t}(x + cs, t + s)\\
          &= 0.
     \end{align*}

     On a ainsi que $z$ est une fonction continue de $s$ et donc que $u$ est
     constante le long de la caractéristique passant par $(x,t)$ et de
     direction $(c, 1)$. Ainsi, si on connaît la valeur de $u$ en n'importe
     lequel des points d'une de ces caractéristiques, on connaît sa valeur
     partout sur $\R \cartprod {\intervaloo{0}{+\infty}}$. On considère le problème
     aux conditions initiales suivant :

     \begin{alignat*}{2}
          \pdv{u}{t} + c \pdv{u}{x} &= 0 \qquad &&\textnormal{sur } \R \cartprod
          {\intervaloo{0}{+\infty}}\\
          u &= f \qquad &&\textnormal{sur } \R \cartprod \{0\}
     \end{alignat*}

     où on suppose $f \colon \R \to \R$ connue. Soit de nouveau $(x,t)$
     fixé. On a $u(x + cs, t + s)$ constante pour $s \in \R$. En utilisant la
     condition initiale, en mettant $s = -t$, on a

     \begin{align*}
          u(x - ct, 0) = f(x - ct).
     \end{align*}

     En posant $s = 0$, on trouve alors finalement

     \begin{align*}
          u(x, t) = f(x - ct) \qquad (x,t) \in \R \cartprod
          {\intervalco{0}{+\infty}}.
     \end{align*}

     La bonne réponse est donc la réponse \fbox{\ref{right1}}.
\end{solution}

\section{Question 2}

Considérons l'équation aux dérivées partielles

\begin{align*}
     \pdv{u}{t} + \beta \pdv{u}{x} = \varepsilon \pdv[2]{u}{x}
\end{align*}

où $\beta$ et $\varepsilon$ sont des paramètres réels positifs.

\vspace*{\baselineskip}
\begin{choices}
     \choice Cette équation est elliptique.
     \choice \label{right2} Cette équation est parabolique.
     \choice Cette équation est hyperbolique.
     \choice Cette équation est non linéaire.
\end{choices}
\vspace*{\baselineskip}

\begin{solution}
     Il s'agit de l'équation d'advection-diffusion, qui est une équation
     parabolique (voir slides du cours 8). La bonne réponse est donc la réponse
     \fbox{\ref{right2}}.
\end{solution}

\section{Question 3}

La solution analytique du problème de Cauchy :
$
     \left\{ \begin{array}{r c l}
     \pdv{u}{t} + \beta \pdv{u}{x} & = & \varepsilon \pdv[2]{u}{x}\\
     u(0,t) & = & 1\\
     u(1,0) & = & 0\\
     u(x,0) & = & 0 \end{array} \right.
$
est donnée par l'expression suivante

\begin{align*}
     u(x,t) = u_0(x) + \sum_k C_k \sin(\pi k x) \exp(ax + bt).
\end{align*}

\begin{itemize}
     \item Donner l'expression de la solution de régime $u_0(x)$.

     \item Donner l'expression des coefficients $a$ et $b$.
\end{itemize}

Par contre, il n'est pas demandé de calculer les coefficients $C_k$
:-).

\begin{solution}
     \begin{itemize}
          \item Comme $u_0(x)$ est la solution de régime et ne dépend plus de
          $t$, le problème de Cauchy est réduit à

          \[
               \left\{ \begin{array}{r c l}
               \beta \fdif{u_0}{x} & = & \varepsilon \ffdif{u_0}{x}\\
               u_0(0) & = & 1\\
               u_0(1) & = & 0. \end{array} \right.
          \]

          Supposons qu'une solution sera proportionelle à $\e^{\lambda x}$ pour
          une constante $\lambda$. On substitue donc $u_0(x) = \e^{\lambda x}$
          dans l'équation différentielle.

          \begin{align*}
               \beta \fdif{(\e^{\lambda x})}{x} &= \varepsilon
               \ffdif{(\e^{\lambda x})}{x}.
          \end{align*}

          On remplace ensuite

          \begin{align*}
               \fdif{(\e^{\lambda x})}{x} &= \lambda \e^{\lambda x}\\
               \ffdif{(\e^{\lambda x})}{x} &= \lambda^2 \e^{\lambda x}.
          \end{align*}

          L'équation devient donc

          \begin{align*}
               \varepsilon \lambda^2 \e^{\lambda x} - \beta \lambda \e^{\lambda
               x} = 0.
          \end{align*}

          On factorise pour trouver

          \begin{align*}
               \lambda \e^{\lambda x} \left(\varepsilon \lambda - \beta \right)
               = 0.
          \end{align*}

          On a deux solutions pour $\lambda$ :

          \begin{align*}
               \lambda = 0 \qquad \textnormal{ou} \qquad \lambda =
               \frac{\beta}{\varepsilon}.
          \end{align*}

          On a donc deux fonctions qui satisfont à la nouvelle PDE; leur somme
          est donc également une solution :

          \begin{align*}
               u_0(x) = c_1 + c_2 \e^{\frac{\beta}{\varepsilon} x}.
          \end{align*}

          Pour trouver les constantes $c_i$, on applique les conditions
          initiales. On trouve le système d'équations suivant.

          \[
               \left\{ \begin{array}{r c r c l}
               c_1 & + & c_2 & = & 1\\
               c_1 & + & \e^{\frac{\beta}{\varepsilon}} c_2 & = & 0.
               \end{array} \right.
          \]

          On trouve les constantes suivantes

          \[
               \left\{ \begin{array}{r c l}
               c_1 & = & \frac{-\e^{\frac{\beta}{\varepsilon}}}{1 -
               \e^{\frac{\beta}{\varepsilon}}}\\
               c_2 & = & \frac{1}{1 - \e^{\frac{\beta}{\varepsilon}}}.
               \end{array} \right.
          \]

          La solution de la nouvelle PDE est donc

          \[
               u_0(x) = \frac{\e^{\frac{\beta}{\varepsilon}x}
               -\e^{\frac{\beta}{\varepsilon}}}{1 -
               \e^{\frac{\beta}{\varepsilon}}}.
          \]

          \item Les coefficients sont donnés par

          \[
               \left\{ \begin{array}{r c l}
               a & = & \frac{\beta}{2\varepsilon}\\
               b & = & -\frac{(2\varepsilon k \pi)^2 + \beta^2}{4 \varepsilon}.
               \end{array} \right.
          \]
     \end{itemize}
\end{solution}

\section{Question 4}

Écrire la fonction de forme de Serendip $\phi(\eta, \xi)$ associé au n\oe{}ud
inférieur gauche de l'élément quadrilatère parent.

\begin{center}
\begin{tikzpicture}
\coordinate (O) at (-1,-1);
\coordinate (A) at (-1,0);
\coordinate (B) at (0,-1);
\coordinate (C) at (1,0);
\coordinate (D) at (0,1);
\coordinate (E) at (1,1);
\coordinate (F) at (1,-1);
\coordinate (G) at (-1,1);

\coordinate (center) at (0,0);

\draw[fill=red!10] (O) -- (F) -- (E) -- (G) -- cycle;

\node[below] at (O) {$(-1,-1)$};
\node[above] at (E) {$(1,1)$};

\node at (center)
{$\mathlarger{\mathlarger{\mathlarger{\mathlarger{\mathlarger{\hat{\Omega}}}}}}$};

\node at (O) [circle,fill=orange,inner sep=1.5pt] {};
\node at (A) [circle,fill,inner sep=1.5pt] {};
\node at (B) [circle,fill,inner sep=1.5pt] {};
\node at (C) [circle,fill,inner sep=1.5pt] {};
\node at (D) [circle,fill,inner sep=1.5pt] {};
\node at (E) [circle,fill,inner sep=1.5pt] {};
\node at (F) [circle,fill,inner sep=1.5pt] {};
\node at (G) [circle,fill,inner sep=1.5pt] {};

%% Following is for debugging purposes so you can see where the points are
%% These are last so that they show up on top
%\foreach \xy in {O, A, B, C, D, E, F, G}{
%    \node at (\xy) {\xy};
%}
\end{tikzpicture}
\end{center}

\begin{solution}
     La technique pour obtenir une fonction de forme associé à un n\oe{}ud d'un
     élément parent est la suivante :

     \begin{enumerate}
          \item bien déterminer l'origine du repère;
          \item tracer des droites passant par tous les points où la fonction
          de forme doit être nulle (autrement dit, tous les points sauf celui
          dont on cherche la fonction de forme);
          \item déterminer les expressions algébriques de celles-ci;
          \item isoler l’expression de la droite trouvée d’un même côté de
          l’équation ($a\xi + b\eta + c = 0$);
          \item normaliser ce produit en se rappelant que la fonction de forme
          évaluée en son n\oe{}ud doit valoir 1.
     \end{enumerate}

     En appliquant cette méthode, nous obtenons $\phi(\xi, \eta) =
     \frac{(\xi - 1)(\eta - 1)(- \xi - \eta - 1)}{4}$.

     Voici une visualisation de la procédure :

     \begin{center}
     \begin{tikzpicture}
     \coordinate (O) at (-1,-1);
     \coordinate (A) at (-1,0);
     \coordinate (B) at (0,-1);
     \coordinate (C) at (1,0);
     \coordinate (D) at (0,1);
     \coordinate (E) at (1,1);
     \coordinate (F) at (1,-1);
     \coordinate (G) at (-1,1);

     \coordinate (center) at (0,0);

     \draw[fill=red!10] (O) -- (F) -- (E) -- (G) -- cycle;

     \node[below] at (O) {$(-1,-1)$};
     \node[above] at (E) {$(1,1)$};

     \node at (center)
     {$\mathlarger{\mathlarger{\mathlarger{\mathlarger{\mathlarger{\hat{\Omega}}}}}}$};

     \node at (O) [circle,fill=orange,inner sep=1.5pt] {};
     \node at (A) [circle,fill,inner sep=1.5pt] {};
     \node at (B) [circle,fill,inner sep=1.5pt] {};
     \node at (C) [circle,fill,inner sep=1.5pt] {};
     \node at (D) [circle,fill,inner sep=1.5pt] {};
     \node at (E) [circle,fill,inner sep=1.5pt] {};
     \node at (F) [circle,fill,inner sep=1.5pt] {};
     \node at (G) [circle,fill,inner sep=1.5pt] {};

     \draw[color=blue, very thick] [domain=-2:2,samples=200] plot(\x, {1}) node[right] {$\eta - 1$};
     \draw[color=green, very thick] (-2,1) -- (1,-2) node[right] {$-\xi - \eta - 1$};
     \draw[color=red, very thick] (1,-2) -- (1,2) node[right] {$\xi - 1$};

     %% Following is for debugging purposes so you can see where the points are
     %% These are last so that they show up on top
     %\foreach \xy in {O, A, B, C, D, E, F, G}{
     %    \node at (\xy) {\xy};
     %}
     \end{tikzpicture}
     \end{center}

\end{solution}

\section{Question 5}

Considérons l'élément trilinéaire $\Omega = \intervalcc{0}{2} \cartprod
\intervalcc{0}{2} \cartprod \intervalcc{0}{2}$. Écrire la fonction de forme
$\phi_1(x, y, z)$ associée au n\oe{}ud $(0,0,0)$.

\newcommand{\Depth}{2}
\newcommand{\Height}{2}
\newcommand{\Width}{2}
\begin{center}
\begin{tikzpicture}
\coordinate (O) at (0,0,0);
\coordinate (A) at (0,\Width,0);
\coordinate (B) at (0,\Width,\Height);
\coordinate (C) at (0,0,\Height);
\coordinate (D) at (\Depth,0,0);
\coordinate (E) at (\Depth,\Width,0);
\coordinate (F) at (\Depth,\Width,\Height);
\coordinate (G) at (\Depth,0,\Height);

\coordinate (center) at (\Depth/2, \Width/2,\Height/2);

\draw[blue,fill=yellow!80] (O) -- (C) -- (G) -- (D) -- cycle;% Bottom Face
\draw[blue,fill=blue!30] (O) -- (A) -- (E) -- (D) -- cycle;% Back Face
\draw[blue,fill=red!10] (O) -- (A) -- (B) -- (C) -- cycle;% Left Face
\draw[blue,fill=red!20,opacity=0.8] (D) -- (E) -- (F) -- (G) -- cycle;% Right Face
\draw[blue,fill=red!20,opacity=0.6] (C) -- (B) -- (F) -- (G) -- cycle;% Front Face
\draw[blue,fill=red!20,opacity=0.8] (A) -- (B) -- (F) -- (E) -- cycle;% Top Face

\node[below] at (O) {$(0,0,0)$};

\node at (center) {$\mathlarger{\mathlarger{\mathlarger{\mathlarger{\mathlarger{\Omega}}}}}$};

\node at (O) [circle,fill,inner sep=1.5pt] {};

%% Following is for debugging purposes so you can see where the points are
%% These are last so that they show up on top
%\foreach \xy in {O, A, B, C, D, E, F, G}{
%    \node at (\xy) {\xy};
%}
\end{tikzpicture}
\end{center}

\begin{solution}
     En appliquant la méthode décrite dans la réponse précédente (avec des
     plans au lieu de droites), nous obtenons la fonction de forme suivante :

     \begin{align*}
          \phi_1(x, y, z) = -\frac{1}{8} (x-2)(y-2)(z-2).
     \end{align*}

     Voici encore une fois la visualisation :

     \begin{center}
     \begin{tikzpicture}
     \coordinate (O) at (0,0,0);
     \coordinate (A) at (0,\Width,0);
     \coordinate (B) at (0,\Width,\Height);
     \coordinate (C) at (0,0,\Height);
     \coordinate (D) at (\Depth,0,0);
     \coordinate (E) at (\Depth,\Width,0);
     \coordinate (F) at (\Depth,\Width,\Height);
     \coordinate (G) at (\Depth,0,\Height);

     \coordinate (center) at (\Depth/2, \Width/2,\Height/2);

     \draw[blue] (O) -- (C) -- (G) -- (D) -- cycle;% Bottom Face
     \draw[blue] (O) -- (A) -- (E) -- (D) -- cycle;% Back Face
     \draw[blue] (O) -- (A) -- (B) -- (C) -- cycle;% Left Face
     \draw[blue] (D) -- (E) -- (F) -- (G) -- cycle;% Right Face
     \draw[blue] (C) -- (B) -- (F) -- (G) -- cycle;% Front Face
     \draw[blue] (A) -- (B) -- (F) -- (E) -- cycle;% Top Face

     \node[below] at (O) {$(0,0,0)$};

     \node at (center) {$\mathlarger{\mathlarger{\mathlarger{\mathlarger{\mathlarger{\Omega}}}}}$};

     \node at (O) [circle,fill,inner sep=1.5pt] {};

     \draw[blue,fill=blue,opacity=0.3] (2,-1,-1) -- (2,-1,3) -- (2,3,3) -- (2,3,-1) -- cycle;
     \node[right,color=blue] at (2,-1,-1) {$x - 2$};
     \draw[green,fill=green,opacity=0.3] (-1,2,-1) -- (-1,2,3) -- (3,2,3) -- (3,2,-1) -- cycle;
     \node[above,color=green] at (-1,2,-1) {$y - 2$};
     \draw[red,fill=red,opacity=0.3] (-1,-1,2) -- (-1,3,2) -- (3,3,2) -- (3,-1,2) -- cycle;
     \node[below,color=red] at (-1,-1,2) {$z - 2$};

     %% Following is for debugging purposes so you can see where the points are
     %% These are last so that they show up on top
     %\foreach \xy in {O, A, B, C, D, E, F, G}{
     %    \node at (\xy) {\xy};
     %}
     \end{tikzpicture}
     \end{center}
\end{solution}

\section{Question 6}

On souhaite résoudre un problème de conduction thermique stationnaire dans un
cube de côté quatre centré à l'origine. La fonction source et la conductivité
thermique sont unitaires. Sur tous les côtés du cube, on impose une valeur
nulle. On peut tirer profit de la symétrie de problème et se contenter de
résoudre le problème sur un huitième du domaine avec notre élément trilinéaire
à 8 n\oe{}uds. Heureusement, nous savons que 7 valeurs nodales sont nulles en
raison des conditions aux frontières. Les coordonnées de l'unique n\oe{}ud non
contraint est $(0,0,0)$.

Calculer l'unique valeur nodale $U_1$ en expliquant la démarche suivie.

\begin{solution}
     Voici la matrice de raideur $A$ et le vecteur de forces nodales $B$ :

     \[
     \begin{pmatrix}
          A_{11} &&&&&&& \\
          &1      &&&&&& \\
          &&1      &&&&& \\
          &&&1      &&&& \\
          &&&&1      &&& \\
          &&&&&1      && \\
          &&&&&&1      & \\
          &&&&&&&1       \\
     \end{pmatrix}
     \begin{pmatrix}
          U_1 \\
          0   \\
          0   \\
          0   \\
          0   \\
          0   \\
          0   \\
          0   \\
     \end{pmatrix}
     =
     \begin{pmatrix}
          B_1 \\
          0   \\
          0   \\
          0   \\
          0   \\
          0   \\
          0   \\
          0   \\
     \end{pmatrix}.
     \]


     En ce qui concerne les valeurs de $A_{22}$ jusque $A_{88}$, on effectue la
     démarche explicitée à la page 59 des notes, à savoir contraindre une
     matrice lorsqu'on impose les conditions essentielles, qui valent dans ce
     cas précis 0. En résumé, il faut remplacer le terme $A_{kk}$ par 1 et
     remplacer toute la ligne et toute la colonne associée à la valeur $T_k$
     par 0. Toutes les entrées vides de la matrice $A$ sont des 0. De plus, il
     faut remplacer la composante $B_k$ par la valeur $T_k$ (ici, $T_k = 0
     \quad \forall k \in \{2, 3, \dots, 8\}$).

     Il nous reste donc à déterminer $A_{11}$ et $B_1$ pour trouver la valeur
     de $U_1$. Par analogie aux éléments bilinéaires, nous avons

     \begin{align*}
     A_{11} &= \int_{\Omega} \left( \pdv{\phi_1}{x} \pdv{\phi_1}{x}
     + \pdv{\phi_1}{y}\pdv{\phi_1}{y} + \pdv{\phi_1}{z}\pdv{\phi_1}{z} \right)
     \dif\Omega \\
     B_1 &= \int_{\Omega} f \phi_1 \dif \Omega.
     \end{align*}

     Nous devons donc effectuer ces deux intégrales sur l'élément trilinéaire
     défini à la question précédente.

     Soient

     \begin{align*}
     \phi_1 &= -\frac{1}{8} (x-2)(y-2)(z-2) \\
     \pdv{\phi_1}{x} &= -\frac{1}{8} (y-2)(z-2) \\
     \pdv{\phi_1}{y} &= -\frac{1}{8} (x-2)(z-2) \\
     \pdv{\phi_1}{z} &= -\frac{1}{8} (x-2)(y-2).
     \end{align*}

     Nous avons donc :

     \begin{align*}
     A_{11} &= \int_{0}^{2} \int_{0}^{2} \int_{0}^{2} \left(
     \frac{(y-2)^2(z-2)^2}{64} + \frac{(x-2)^2(z-2)^2}{64} +
     \frac{(x-2)^2(y-2)^2}{64} \right) \dif x \dif y \dif z \\
     B_1 &= \int_{0}^{2} \int_{0}^{2} \int_{0}^{2} -\frac{1}{8} (x-2)(y-2)(z-2)
     f \dif x \dif y \dif z. \\
     \end{align*}

     En effectuant cette première intégrale, on trouve que $A_{11} =
     \frac{2}{3}$. Pour le calcul de la seconde intégrale, on remarque que $f$
     est unitaire. On déduit alors que

     \begin{align*}
          B_1 = \int_{0}^{2} \int_{0}^{2} \int_{0}^{2} -\frac{1}{8}
          (x-2)(y-2)(z-2) \dif x \dif y \dif z = 1.
     \end{align*}

     Par produit matriciel, on trouve alors que

     \begin{align*}
          U_1 &= \frac{B_1}{A_{11}} \\
          &= \frac{3}{2}.
     \end{align*}
\end{solution}

\section{Question 7}

Pour des fonctions de forme bilinéaires, on souhaite calculer la matrice locale
définie comme suit :

\begin{align*}
     A_{ij} = \int_{\Omega} \left( \pdv{phi_i}{x} \pdv{phi_j}{x} + \pdv{phi_i}{y} \pdv{phi_j}{y} \right) \dif x \dif y.
\end{align*}

On va écrire une fonction \clang{} qui effectue l'intégration numérique pour
obtenir cette matrice en faisant appel par une règle de Gauss-Legendre à 4
points sur un quadrilatère défini par ses quatre sommets.

Malheureusement, quelques lignes de code on été subtilisées par un informaticien
facétieux.

Il s'agit donc de compléter l'implémentation ci-dessous.

La matrice $A$ a été initialisée à zéro avant l'appel de notre fonction.

\begin{lstlisting}
void localMatrixIntegrate(double x[4], double y[4], double A[4][4])
{
     double I = 0;
     const double a = 0.577350269189626;
     const double xsi[4]    = {  a,  a, -a, -a};
     const double eta[4]    = {  a, -a, -a,  a};
     const double weight[4] = {1.0,1.0,1.0,1.0};
     double dphidx[4];
     double dphidy[4];
     int i,j,k,l;

     for (i=0; i<4; i++) {
          double xsiLoc = xsi[i];
          double etaLoc = eta[i];
          double phi[4] = {(1+xsiLoc)*(1+etaLoc)/4.0, (1-xsiLoc)*(1+etaLoc)/4.0,
               (1-xsiLoc)*(1-etaLoc)/4.0, (1+xsiLoc)*(1-etaLoc)/4.0};
          double dphidxsi[4] = {(1+etaLoc)/4.0,-(1+etaLoc)/4.0,-(1-etaLoc)/4.0,(1-etaLoc)/4.0};
          double dphideta[4] = {(1+xsiLoc)/4.0,(1-xsiLoc)/4.0,-(1-xsiLoc)/4.0,-(1+xsiLoc)/4.0};
          double dxdxsi = 0;
          double dydxsi = 0;
          double dxdeta = 0;
          double dydeta = 0;




























          for (k = 0; k < 4; k++) {
               for (l = 0; l < 4; l++) {
                    A[k][l] += (dphidx[k] * dphidx[l] + dphidy[k] * dphidy[l]) * jac * weight; }}
     }
}
\end{lstlisting}

\begin{solution}
\begin{lstlisting}
void localMatrixIntegrate(double x[4], double y[4], double A[4][4])
{
     double I = 0;
     const double a = 0.577350269189626;
     const double xsi[4]    = {  a,  a, -a, -a};
     const double eta[4]    = {  a, -a, -a,  a};
     const double weight[4] = {1.0,1.0,1.0,1.0};
     double dphidx[4];
     double dphidy[4];
     int i,j,k,l;

     for (i=0; i<4; i++) {
          double xsiLoc = xsi[i];
          double etaLoc = eta[i];
          double phi[4] = {(1+xsiLoc)*(1+etaLoc)/4.0, (1-xsiLoc)*(1+etaLoc)/4.0,
               (1-xsiLoc)*(1-etaLoc)/4.0, (1+xsiLoc)*(1-etaLoc)/4.0};
          double dphidxsi[4] = {(1+etaLoc)/4.0,-(1+etaLoc)/4.0,-(1-etaLoc)/4.0,(1-etaLoc)/4.0};
          double dphideta[4] = {(1+xsiLoc)/4.0,(1-xsiLoc)/4.0,-(1-xsiLoc)/4.0,-(1+xsiLoc)/4.0};
          double dxdxsi = 0;
          double dydxsi = 0;
          double dxdeta = 0;
          double dydeta = 0;

          \\ START

          double dphidx[4], dphidy[4];
          for(j = 0; j<4;j++)
          {
              dxdxsi += dphidxsi[j]*x[j] ;
              dydxsi += dphidxsi[j]*y[j] ;
              dxdeta += dphideta[j]*x[j] ;
              dydeta += dphideta[j]*y[j] ;
          }
          double jac = dxdxsi*dydeta - dxdeta*dydxsi;
          for( j = 0 ; j<4 ; j++)
          {
              dphidx[j] = (dphidxsi[j]*dydeta - dphideta[j]*dydxsi)/jac;
              dphidy[j] =(dphidxsi[j]*(-1*dxdeta)+dphideta[j]*dxdxsi)/jac ;
          }

          \\ END

          for (k = 0; k < 4; k++) {
               for (l = 0; l < 4; l++) {
                    A[k][l] += (dphidx[k] * dphidx[l] + dphidy[k] * dphidy[l]) * jac * weight; }}
     }
}
\end{lstlisting}
\end{solution}

\section{Question 8}



\end{document}
